# Railway Production Deployment Configuration
#
# This file defines how the research-auditor app is deployed to Railway.
# It's referenced by: .github/workflows/reusable/deploy.yml
#
# GHCR path: Nix builds image → Ship pushes to GHCR → Deploy passes this start_command.
# railway.toml is for Railpack (build-from-source) reference only; not used here.
#
# To update deployment:
#   1. Edit this file
#   2. Commit and push
#   3. Tag a new version: git tag vX.Y.Z && git push origin vX.Y.Z
#   4. GitHub Actions will deploy automatically

app: research-auditor
environment: production

railway:
  # Project ID: set here OR add RAILWAY_PROJECT_ID repo secret (Railway: Cmd+K → Copy Project ID)
  project_id: ""  # e.g. "abc12345-1234-1234-1234-123456789abc"
  service_name: research-auditor

  container:
    # Image is built by Nix and pushed to GHCR
    # Format: ghcr.io/OWNER/research-auditor:TAG
    registry: ghcr.io
    repository: "{{ github.repository_owner }}/research-auditor"

    # Aligned with flake.nix CMD: FastAPI + Uvicorn
    # PORT is set by Railway; uv sync ensures deps in container.
    start_command: "bash -c 'cd /app && uv sync --frozen && exec uv run --frozen uvicorn app.entrypoints.http:app --host 0.0.0.0 --port ${PORT:-8080}'"
    
    # Port configuration
    port: 8080
  
  resources:
    # Memory limit (MB)
    memory: 512
    
  # Health check configuration
  health_check:
    path: /health
    interval: 30
    timeout: 10